<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Comprehensive eSIM Transfer and Management System for iOS and Android devices with real-time monitoring and Myanmar carrier support">
    <link rel="canonical" href="https://esim.com.mm/dashboard">
    <title>eSIM Manager Dashboard - Myanmar Carrier Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" defer>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style">
    <style>
        :root {
            --primary: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--light); color: var(--dark); line-height: 1.6; }
        .header { background: linear-gradient(135deg, var(--primary) 0%, #1e40af 100%); color: white; padding: 2rem; text-align: center; box-shadow: var(--shadow); }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; }
        .header p { opacity: 0.9; font-size: 1.1rem; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid var(--border); transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15); }
        .card-header { display: flex; align-items: center; margin-bottom: 1.5rem; }
        .card-header i { font-size: 1.5rem; margin-right: 0.75rem; color: var(--primary); }
        .card h3 { color: var(--dark); font-size: 1.25rem; font-weight: 600; }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; }
        .status-online { background: #dcfce7; color: #166534; }
        .status-offline { background: #fee2e2; color: #991b1b; }
        .status-degraded { background: #fef3c7; color: #92400e; }
        .metric { display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0; padding: 1rem; background: var(--light); border-radius: 8px; border-left: 4px solid var(--primary); }
        .metric-label { font-weight: 500; color: var(--dark); }
        .metric-value { font-weight: 700; font-size: 1.25rem; color: var(--primary); }
        .progress-container { margin: 1rem 0; }
        .progress-label { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem; font-weight: 500; }
        .progress-bar { width: 100%; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--success), #059669); transition: width 0.5s ease; border-radius: 4px; }
        .alert { padding: 1rem; margin: 1rem 0; border-radius: 8px; border-left: 4px solid; }
        .alert-success { background: #f0fdf4; color: #166534; border-left-color: var(--success); }
        .alert-warning { background: #fffbeb; color: #92400e; border-left-color: var(--warning); }
        .alert-danger { background: #fef2f2; color: #991b1b; border-left-color: var(--danger); }
        .device-list { max-height: 350px; overflow-y: auto; }
        .device-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--border); transition: background 0.2s; }
        .device-item:hover { background: var(--light); }
        .device-item:last-child { border-bottom: none; }
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; }
        .btn:hover { transform: translateY(-1px); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--dark); }
        .btn-outline:hover { background: var(--light); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 8px; text-align: center; border: 1px solid var(--border); }
        .stat-number { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem; }
        .action-bar { display: flex; gap: 0.75rem; flex-wrap: wrap; margin-top: 1.5rem; }
        .transfer-log { max-height: 300px; overflow-y: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; background: #1f2937; color: #f9fafb; padding: 1rem; border-radius: 8px; }
        .log-entry { margin: 0.25rem 0; padding: 0.5rem; border-left: 3px solid var(--primary); background: rgba(255, 255, 255, 0.05); border-radius: 4px; }
        .log-success { border-left-color: var(--success); }
        .log-error { border-left-color: var(--danger); }
        .log-warning { border-left-color: var(--warning); }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; padding: 1rem; border-radius: 8px; color: white; font-weight: 500; transform: translateX(400px); transition: transform 0.3s ease; }
        .notification.show { transform: translateX(0); }
        .notification.success { background: var(--success); }
        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 2rem; }
            .action-bar { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="header" role="banner">
        <h1><i class="fas fa-sim-card" aria-hidden="true"></i> eSIM Manager Dashboard</h1>
        <p>Comprehensive eSIM Transfer and Management System</p>
        <p id="last-updated">Last Updated: <span id="timestamp"></span></p>
    </div>

    <main class="container" role="main">
        <a href="#main-content" class="sr-only">Skip to main content</a>
        <!-- System Health Overview -->
        <section class="card" id="main-content">
            <div class="card-header">
                <i class="fas fa-heartbeat"></i>
                <h3>System Health Overview</h3>
            </div>
            <div class="progress-container">
                <div class="progress-label">
                    <span>Overall System Health</span>
                    <span id="system-health">75%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="health-progress" style="width: 75%"></div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="services-online">6</div>
                    <div class="stat-label">Services Online</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="services-total">8</div>
                    <div class="stat-label">Total Services</div>
                </div>
            </div>
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Warning:</strong> EMS E3 license required for full functionality
            </div>
        </section>

        <div class="grid">
            <!-- Domain Monitoring -->
            <article class="card">
                <div class="card-header">
                    <i class="fas fa-globe"></i>
                    <h3>Domain & API Status</h3>
                </div>
                <div id="domain-status">
                    <div class="metric">
                        <div>
                            <div class="metric-label">thl-mcs-d-odccsm.firebaseio.com</div>
                            <small style="color: #6b7280;">USA-Missouri</small>
                        </div>
                        <span class="status-badge status-online">ONLINE</span>
                    </div>
                    <div class="metric">
                        <div>
                            <div class="metric-label">support.google.com</div>
                            <small style="color: #6b7280;">USA-California</small>
                        </div>
                        <span class="status-badge status-online">ONLINE</span>
                    </div>
                    <div class="metric">
                        <div>
                            <div class="metric-label">simtransfer.goog</div>
                            <small style="color: #6b7280;">Location Unknown</small>
                        </div>
                        <span class="status-badge status-degraded">DEGRADED</span>
                    </div>
                    <div class="metric">
                        <div>
                            <div class="metric-label">migrate.google</div>
                            <small style="color: #6b7280;">USA-California</small>
                        </div>
                        <span class="status-badge status-online">ONLINE</span>
                    </div>
                    <div class="metric">
                        <div>
                            <div class="metric-label">httpstat.us</div>
                            <small style="color: #6b7280;">USA-Iowa</small>
                        </div>
                        <span class="status-badge status-online">ONLINE</span>
                    </div>
                    <div class="metric">
                        <div>
                            <div class="metric-label">carrier-qrcless-demo.appspot.com</div>
                            <small style="color: #6b7280;">Ireland-Dublin</small>
                        </div>
                        <span class="status-badge status-offline">OFFLINE</span>
                    </div>
                </div>
                <div class="action-bar">
                    <button class="btn btn-primary" onclick="refreshDomainStatus()" aria-label="Refresh domain status">
                        <i class="fas fa-sync-alt" aria-hidden="true"></i> Refresh Status
                    </button>
                    <button class="btn btn-outline" onclick="viewDomainDetails()" aria-label="View domain details">
                        <i class="fas fa-chart-line" aria-hidden="true"></i> View Details
                    </button>
                </div>
            </div>

            <!-- Device Management -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-mobile-alt"></i>
                    <h3>Device Management</h3>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">24</div>
                        <div class="stat-label">Total Devices</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--success);">18</div>
                        <div class="stat-label">Compliant</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--danger);">6</div>
                        <div class="stat-label">Non-Compliant</div>
                    </div>
                </div>
                <div class="device-list">
                    <div class="device-item">
                        <div>
                            <div class="metric-label">iPhone 14 Pro</div>
                            <small style="color: #6b7280;">iOS 16.5 • Last sync: 2 min ago</small>
                            <img src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA" alt="iPhone 14 Pro device icon" loading="lazy" style="display:none;">
                        </div>
                        <span class="status-badge status-online">COMPLIANT</span>
                    </div>
                    <div class="device-item">
                        <div>
                            <div class="metric-label">Samsung Galaxy S23</div>
                            <small style="color: #6b7280;">Android 13 • Last sync: 5 min ago</small>
                        </div>
                        <span class="status-badge status-online">COMPLIANT</span>
                    </div>
                    <div class="device-item">
                        <div>
                            <div class="metric-label">iPhone 13</div>
                            <small style="color: #6b7280;">iOS 15.7 • Last sync: 2 hours ago</small>
                        </div>
                        <span class="status-badge status-offline">NON-COMPLIANT</span>
                    </div>
                </div>
                <div class="action-bar">
                    <button class="btn btn-success" onclick="syncAllDevices()" aria-label="Sync all devices">
                        <i class="fas fa-sync" aria-hidden="true"></i> Sync All
                    </button>
                    <button class="btn btn-outline" onclick="viewAllDevices()" aria-label="View all devices">
                        <i class="fas fa-list" aria-hidden="true"></i> View All
                    </button>
                </div>
            </div>

            <!-- Myanmar Carriers -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-broadcast-tower"></i>
                    <h3>Myanmar Carrier Status</h3>
                </div>
                <div class="metric">
                    <div>
                        <div class="metric-label">MPT (414-01)</div>
                        <small style="color: #6b7280;">mpt-smdp.com.mm</small>
                    </div>
                    <span class="status-badge status-online">ONLINE</span>
                </div>
                <div class="metric">
                    <div>
                        <div class="metric-label">ATOM (414-06)</div>
                        <small style="color: #6b7280;">atom-smdp.com.mm</small>
                    </div>
                    <span class="status-badge status-online">ONLINE</span>
                </div>
                <div class="metric">
                    <div>
                        <div class="metric-label">OOREDOO (414-05)</div>
                        <small style="color: #6b7280;">ooredoo-smdp.com.mm</small>
                    </div>
                    <span class="status-badge status-degraded">DEGRADED</span>
                </div>
                <div class="metric">
                    <div>
                        <div class="metric-label">MYTEL (414-09)</div>
                        <small style="color: #6b7280;">mytel-smdp.com.mm</small>
                    </div>
                    <span class="status-badge status-online">ONLINE</span>
                </div>
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    3 of 4 carrier SM-DP+ servers fully operational
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- eSIM Transfer Activity -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-exchange-alt"></i>
                    <h3>Recent eSIM Transfers</h3>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">12</div>
                        <div class="stat-label">Transfers Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--success);">94%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
                <div class="transfer-log">
                    <div class="log-entry log-success">
                        <i class="fas fa-check"></i> [14:32:15] Transfer completed: iPhone14Pro → GalaxyS23 (MPT)
                    </div>
                    <div class="log-entry log-success">
                        <i class="fas fa-check"></i> [14:28:42] Transfer completed: iPhone13 → iPhone14 (OOREDOO)
                    </div>
                    <div class="log-entry log-error">
                        <i class="fas fa-times"></i> [14:15:33] Transfer failed: Device not compliant (ATOM)
                    </div>
                    <div class="log-entry log-warning">
                        <i class="fas fa-clock"></i> [14:02:18] Transfer delayed: SM-DP+ timeout (MYTEL)
                    </div>
                    <div class="log-entry log-success">
                        <i class="fas fa-check"></i> [13:45:27] Transfer completed: GalaxyS22 → iPhone13Pro (MPT)
                    </div>
                </div>
                <div class="action-bar">
                    <button class="btn btn-success" onclick="startTransfer()" aria-label="Start new eSIM transfer">
                        <i class="fas fa-plus" aria-hidden="true"></i> Start New Transfer
                    </button>
                    <button class="btn btn-outline" onclick="viewTransferHistory()" aria-label="View transfer history">
                        <i class="fas fa-history" aria-hidden="true"></i> View History
                    </button>
                </div>
            </div>

            <!-- System Alerts -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-bell"></i>
                    <h3>System Alerts</h3>
                </div>
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle"></i>
                    <strong>Critical:</strong> EMS E3 license required for Intune functionality
                </div>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Warning:</strong> 6 devices require compliance updates
                </div>
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle"></i>
                    <strong>Notice:</strong> OOREDOO SM-DP+ server experiencing delays
                </div>
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <strong>Info:</strong> All domain endpoints responding normally
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-bolt"></i>
                <h3>Quick Actions</h3>
            </div>
            <div class="action-bar">
                <button class="btn btn-primary" onclick="runHealthCheck()">
                    <i class="fas fa-heartbeat"></i> Run Health Check
                </button>
                <button class="btn btn-success" onclick="deployProfiles()">
                    <i class="fas fa-rocket"></i> Deploy eSIM Profiles
                </button>
                <button class="btn btn-primary" onclick="syncDevices()">
                    <i class="fas fa-sync"></i> Sync All Devices
                </button>
                <button class="btn btn-danger" onclick="viewLogs()">
                    <i class="fas fa-file-alt"></i> View Error Logs
                </button>
                <button class="btn btn-outline" onclick="generateReport()">
                    <i class="fas fa-chart-bar"></i> Generate Report
                </button>
                <button class="btn btn-outline" onclick="openSettings()">
                    <i class="fas fa-cog"></i> Settings
                </button>
            </div>
        </div>
    </main>

    <script defer>
        // API Configuration
        const API_BASE = '/api/v1';
        const WS_URL = 'ws://localhost:8080/ws';
        
        // WebSocket connection for real-time updates
        let ws = null;
        
        function initWebSocket() {
            try {
                ws = new WebSocket(WS_URL);
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    updateDashboard(data);
                };
                ws.onclose = () => {
                    setTimeout(initWebSocket, 5000);
                };
            } catch (error) {
                console.log('WebSocket not available, using polling');
                setInterval(fetchDashboardData, 30000);
            }
        }
        
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                };
                if (data) options.body = JSON.stringify(data);
                
                const response = await fetch(API_BASE + endpoint, options);
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                showNotification('API call failed: ' + error.message, 'error');
                return null;
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<i class="fas fa-${type === 'error' ? 'times-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }
        
        async function refreshDomainStatus() {
            showNotification('Refreshing domain status...', 'info');
            const result = await apiCall('/domains/status');
            if (result) {
                updateDomainStatus(result);
                showNotification('Domain status updated', 'success');
            }
        }
        
        async function startTransfer() {
            const sourceDevice = prompt('Enter source device ID:');
            const targetDevice = prompt('Enter target device ID:');
            const carrier = prompt('Enter carrier code (MPT/ATOM/OOREDOO/MYTEL):');
            
            if (sourceDevice && targetDevice && carrier) {
                showNotification('Starting eSIM transfer...', 'info');
                const result = await apiCall('/transfer/start', 'POST', {
                    sourceDevice,
                    targetDevice,
                    carrier
                });
                if (result && result.success) {
                    showNotification('Transfer initiated successfully', 'success');
                } else {
                    showNotification('Transfer failed: ' + (result?.message || 'Unknown error'), 'error');
                }
            }
        }
        
        async function runHealthCheck() {
            showNotification('Running comprehensive health check...', 'info');
            const result = await apiCall('/system/health');
            if (result) {
                updateSystemHealth(result);
                showNotification(`Health check completed: ${result.healthPercentage}%`, 'success');
            }
        }
        
        async function deployProfiles() {
            const carrier = prompt('Enter carrier code (MPT/ATOM/OOREDOO/MYTEL) or leave empty for all:');
            showNotification('Deploying eSIM profiles...', 'info');
            const result = await apiCall('/profiles/deploy', 'POST', { carrier });
            if (result && result.success) {
                showNotification(`Deployed profiles to ${result.deviceCount} devices`, 'success');
            }
        }
        
        async function syncDevices() {
            showNotification('Syncing all managed devices...', 'info');
            const result = await apiCall('/devices/sync', 'POST');
            if (result && result.success) {
                showNotification(`Synced ${result.deviceCount} devices`, 'success');
            }
        }
        
        async function viewLogs() {
            window.open('/logs', '_blank');
        }
        
        async function generateReport() {
            showNotification('Generating comprehensive system report...', 'info');
            const result = await apiCall('/reports/generate', 'POST');
            if (result && result.reportUrl) {
                window.open(result.reportUrl, '_blank');
                showNotification('Report generated successfully', 'success');
            }
        }
        
        function viewDomainDetails() {
            window.open('/domains', '_blank');
        }
        
        function syncAllDevices() {
            syncDevices();
        }
        
        function viewAllDevices() {
            window.open('/devices', '_blank');
        }
        
        function viewTransferHistory() {
            window.open('/transfers', '_blank');
        }
        
        function openSettings() {
            window.open('/settings', '_blank');
        }
        
        function updateDashboard(data) {
            if (data.systemHealth) updateSystemHealth(data.systemHealth);
            if (data.domains) updateDomainStatus(data.domains);
            if (data.devices) updateDeviceStatus(data.devices);
            if (data.transfers) updateTransferLog(data.transfers);
        }
        
        function updateSystemHealth(health) {
            document.getElementById('system-health').textContent = health.percentage + '%';
            document.getElementById('health-progress').style.width = health.percentage + '%';
            document.getElementById('services-online').textContent = health.onlineServices;
            document.getElementById('services-total').textContent = health.totalServices;
        }
        
        function updateDomainStatus(domains) {
            console.log('Updating domain status:', domains);
        }
        
        function updateDeviceStatus(devices) {
            console.log('Updating device status:', devices);
        }
        
        function updateTransferLog(transfers) {
            console.log('Updating transfer log:', transfers);
        }
        
        async function fetchDashboardData() {
            const data = await apiCall('/dashboard/data');
            if (data) updateDashboard(data);
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Add structured data
            const structuredData = {
                "@context": "https://schema.org",
                "@type": "SoftwareApplication",
                "name": "eSIM Manager Dashboard",
                "description": "Comprehensive eSIM Transfer and Management System",
                "applicationCategory": "BusinessApplication",
                "operatingSystem": "Web Browser"
            };
            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(structuredData);
            document.head.appendChild(script);
            initWebSocket();
            fetchDashboardData();
            
            // Auto-refresh timestamp every minute
            setInterval(function() {
                document.getElementById('timestamp').textContent = new Date().toLocaleString();
            }, 60000);
            
            // Simulate real-time updates for demo
            setInterval(function() {
                const healthValue = Math.floor(Math.random() * 10) + 70;
                updateSystemHealth({
                    percentage: healthValue,
                    onlineServices: healthValue > 75 ? 6 : 5,
                    totalServices: 8
                });
            }, 15000);
        });
    </script>
</body>
</html>